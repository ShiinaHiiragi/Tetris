<!DOCTYPE HTML>

<html>

<head>
  <title>Tetris</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Dependency Include Here -->
  <link href="./semantic/dist/semantic.min.css" rel="stylesheet" type="text/css">
  <script src="./semantic/dist/semantic.min.js"></script>

  <!-- Customized Resources -->
  <style>
    .panel {
      height: 90vh;
      width: 40vw;
      padding-top: 10vh;
      margin-left: 30vw;
    }

    .side {
      float: left;
      height: 80vh;
      width: calc((40vw - 40vh) / 2);
      /* background-color: lightcyan; */
    }

    .field {
      float: left;
      height: 80vh;
      width: 40vh;
      border: 1px solid rgb(225, 225, 225);
    }

    .cell {
      height: 5%;
      width: 10%;
      float: left;
      background-color: rgb(225, 225, 225);
      border: 1px solid rgb(240, 240, 240);
    }
  </style>
</head>

<body>
  <div class="panel">
    <div class="side" id="left-side">
      <!-- TODO: Hold & Score Here -->
    </div>
    <div class="field" id="field"></div>
    <div class="side" id="right-side">
      <!-- TODO: Next Pieces Here -->
    </div>
  </div>
  <script>
    // TODO: delete these variables after releasing
    var cellsColor = new Array(20);
    for (var i = 0; i < 20; i += 1)
      cellsColor[i] = new Array(10).fill(0);
    function setColor(element)
    {
      var str = element.id.split("-");
      var index = (cellsColor[Number(str[1])][Number(str[2])] += 1);
      element.style.backgroundColor = Settings.color[index % 8];
      // used for manipulating transparency
      // element.style.opacity = "0.5";
    }

    // TODO: initializing variables from settings.json
    var Settings =
    {
      color:
      [
        "rgb(225, 225, 225)", "rgb(252, 92, 101)",
        "rgb(253, 150, 68)", "rgb(254, 211, 48)",
        "rgb(38, 222, 129)", "rgb(69, 170, 242)",
        "rgb(75, 123, 236)", "rgb(165, 94, 234)"
      ],
      pieces:
      [
        null,
        [
          [[0, -1], [-1, -1], [-1, 0]], [[-1, 0], [-1, 1], [0, 1]],
          [[0, 1], [1, 1], [1, 0]], [[1, 0], [1, -1], [0, -1]]
        ],
        [
          [[0, 1], [0, -1], [-1, 1]], [[1, 0], [-1, 0], [1, 1]],
          [[0, -1], [0, 1], [1, -1]], [[-1, 0], [1, 0], [-1, -1]]
        ],
        [
          [[0, 1], [0, -1], [-1, -1]], [[1, 0], [-1, 0], [-1, 1]],
          [[0, -1], [0, 1], [1, 1]], [[-1, 0], [1, 0], [1, -1]]
        ],
        [
          [[0, 1], [0, -1], [-1, 0]], [[1, 0], [-1, 0], [0, 1]],
          [[0, -1], [0, 1], [1, 0]], [[-1, 0], [1, 0], [0, -1]]
        ],
        [
          [[0, -1], [-1, 0], [-1, 1]], [[-1, 0], [0, 1], [1, 1]],
          [[0, 1], [1, 0], [1, -1]], [[1, 0], [0, -1], [-1, -1]]
        ],
        [
          [[0, 1], [-1, -1], [-1, 0]], [[1, 0], [-1, 1], [0, 1]],
          [[0, -1], [1, 1], [1, 0]], [[-1, 0], [1, -1], [0, -1]]
        ],
        [
          [[0, 1], [0, -1], [0, -2]], [[1, 0], [-1, 0], [-2, 0]],
          [[0, -1], [0, 1], [0, 2]], [[-1, 0], [1, 0], [2, 0]]
        ]
      ],
      fallTime: 1
    }
    // process raw setting in the file
    // fallTime: 1 ~ 10; 1: 1000ms, 10: 100ms
    Settings.fallTime = 1100 - Settings.fallTime * 100;

    // Panel: The cell and the data of Tetris
    var Panel = 
    {
      cells: new Array(24),
      score: 0,
      line: 0
    }
    // process raw panel data
    for (var i = 0; i < 24; i += 1)
      Panel.cells[i] = new Array(10).fill(0);

    // Piece: The block available for manipupating
    var Piece = 
    {
      // the position of top left corner is [4, 0]
      position: [10, 3],
      // type: 1 ~ 7; O, L, J, T, S, Z, I
      type: 2,
      // direction: 0 ~ 3
      direction: 0,
      // draw the piece on the panel and the array
      draw: function()
      {
        var center = [this.position[0] - 4, this.position[1]];
        var bias = Settings.pieces[this.type][this.direction];
        Cite.cells[center[0]][center[1]].style.backgroundColor = Settings.color[this.type];
        Panel.cells[center[0] + 4][center[1]] = 1;
        for (var index = 0; index < 3; index += 1)
        {
          var bias = Settings.pieces[this.type][this.direction][index];
          Panel.cells[center[0] + bias[0] + 4][center[1] + bias[1]] = 1;
          Cite.cells[center[0] + bias[0]][center[1] + bias[1]].style.backgroundColor = Settings.color[this.type];
        }
      }
    }

    // Cite: the element in the HTML DOM
    var Cite = 
    {
      // field: a cite for field
      field: document.getElementById("field"),
      // cells: a two-dimension array citing the 10 Ã— 20 grid
      cells: new Array(20)
    }
    // process the raw element in the DOM
    for (var i = 0; i < 20; i += 1)
      Cite.cells[i] = new Array(10).fill(null);
    for (var i = 0; i < 20; i += 1)
      for (var j = 0; j < 10; j += 1)
      {
        Cite.cells[i][j] = document.createElement("div");
        Cite.cells[i][j].className = "cell";
        Cite.cells[i][j].id = "cell-" + i.toString() + "-" + j.toString();
        // TODO: delete this arrtibute before realeasing
        Cite.cells[i][j].setAttribute("onclick", "setColor(this)")
        Cite.field.append(Cite.cells[i][j]);
      }
  </script>
</body>
</html>